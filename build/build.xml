<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Phing build file for guzzle-encoding-com
 *
 * @author svilborg
 * @link https://github.com/svilborg/guzzle-encoding-com
 * @license Apache2
 */
-->
<project name="guzzle-encoding-com" basedir="../" default="help">

	<!-- these are required external commands -->
	<property name="php" value="php" />
	<!-- PHP parser -->

	<!-- directory definitions -->
	<property name="dir.output" value="${project.basedir}/build" />
	<property name="build.basedir" value="release" />
	<property name="build.dist.dir" value="${build.basedir}/dist" />

	<tstamp>
		<format property="DATE" pattern="%b %e %Y" />
	</tstamp>

	<if>
		<equals arg1="${yii.winbuild}" arg2="true" />
		<then>
			<property name="build" value="build" />
		</then>
		<else>
			<property name="build" value="php build" />
		</else>
	</if>

	<!-- source files in library -->
	<fileset dir=".." id="library">
		<exclude name="**/.gitignore" />
		<exclude name="**/*.bak" />
		<exclude name="**/*~" />
		<include name="src**/*" />
		<include name="LICENSE" />
		<include name="README.md" />
	</fileset>

	<!-- doc files -->
	<fileset dir="../docs" id="docs">
		<exclude name="**/.gitignore" />
		<exclude name="**/*.bak" />
		<exclude name="**/*~" />
		<include name="guide/**/*" />
		<include name="blog/**/*" />
	</fileset>

	<target name="php-lint" description="PHP Lint Source Check">
		<phplint level="info">
			<fileset dir="${project.basedir}/src">
				<include name="**/*.php" />
			</fileset>
		</phplint>
		<phplint level="info">
			<fileset dir="${project.basedir}/tests">
				<include name="**/*.php" />
			</fileset>
		</phplint>
	</target>

	<target name="sniff" description="Check code for PSR-2 compliance">
		<phpcodesniffer standard="PSR2" format="summary">
			<!-- format="summary" -->
			<fileset dir="src" id="filestosniff">
				<include name="**/*.php" />
			</fileset>
		</phpcodesniffer>
	</target>

	<target name="phploc" description="Measure project size using PHPLOC">
		<exec command="phploc --log-csv ${dir.output}/logs/phploc.csv ${project.basedir}/src" passthru="true" />
	</target>

	<target name="pdepend" description="Calculate software metrics using PHP_Depend">
		<mkdir dir="${dir.output}/pdepend" />
		<phpdepend>
			<fileset dir="${project.basedir}/src">
				<include name="**/*.php" />
			</fileset>
			<logger type="jdepend-xml" outfile="${dir.output}/logs/jdepend.xml" />
			<logger type="jdepend-chart" outfile="${dir.output}/pdepend/dependencies.svg" />
			<logger type="overview-pyramid" outfile="${dir.output}/pdepend/overview-pyramid.svg" />
			<analyzer type="coderank-mode" value="method" />
		</phpdepend>
	</target>

	<target name="clean">
		<echo>Cleaning up the build...</echo>
		<delete dir="${build.basedir}" />
	</target>

	<target name="help">
		<echo>
guzzle-encoding-com build script
--------------------------------

Usage :
    phing   &lt;target name&gt;

Options :

   - clean    : Clean up Build
   - php-lint : PHP Lint Source Check

    </echo>
	</target>
</project>